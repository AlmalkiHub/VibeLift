import streamlit as st
import os
from motivation_engine import get_motivation
from PIL import Image
from gtts import gTTS
import tempfile

# Page config
st.set_page_config(page_title="ğŸ§  VibeLift: Recharge Your Mind", layout="centered")

# Custom Title
st.markdown("<h1 style='text-align: center;'>ğŸ§  VibeLift: Recharge Your Mind</h1>", unsafe_allow_html=True)
st.markdown("#### <center>Let the AI coach lift your spirits âœ¨</center>", unsafe_allow_html=True)
st.write("")

# Collect user inputs
name = st.text_input("What's your name?", "Ali")

predefined_mood = st.selectbox("How are you feeling today?", ["Happy ğŸ˜„", "Sad ğŸ˜¢", "Stressed ğŸ˜–", "Excited ğŸ¤©", "Calm ğŸ˜Œ", "Angry ğŸ˜ ", "Anxious ğŸ˜¬"])
mood_description = st.text_input("Or describe your mood in your own words", "")

time_of_day = st.selectbox("What time of day is it?", ["Morning ğŸŒ…", "Afternoon ğŸ˜Š", "Evening ğŸŒ‡", "Night ğŸŒ™"])

tone = st.radio("Choose your preferred tone:",
                ["Inspirational ğŸŒŸ", "Friendly ğŸ˜Š", "Tough Love â¤ï¸", "Spiritual ğŸƒ"])

# Use custom mood if entered
mood_input = mood_description if mood_description.strip() else predefined_mood

# Generate motivation
if st.button("â¤ï¸ Get Motivation / Regenerate"):
    message, image_url = get_motivation(name, mood_input, time_of_day, tone)
    st.session_state.message = message
    st.session_state.image_url = image_url

# Display message
if "message" in st.session_state:
    st.markdown("### ğŸ’¬ Your Message:")
    st.success(st.session_state.message)

# Read Aloud button
if "message" in st.session_state and st.button("ğŸ”Š Read it Aloud"):
    tts = gTTS(text=st.session_state.message, lang='en')
    with tempfile.NamedTemporaryFile(delete=False, suffix=".mp3") as tmpfile:
        tts.save(tmpfile.name)
        st.audio(tmpfile.name, format="audio/mp3")

# Display image
if "image_url" in st.session_state:
    st.markdown("### ğŸ–¼ï¸ Your Mood-Inspired Image:")
    st.image(st.session_state.image_url, caption="Generated by DALLÂ·E 3")

# Personal Footer
st.markdown("---")
st.markdown("#### ğŸ‘¤ About the Creator")
image = Image.open("Ali Almalki.JPG")
st.image(image, width=200)
st.markdown("""
ğŸ‘¨ğŸ»â€ğŸ’» Built with love by Ali Almalki  
ğŸ“ Jeddah & NEOM | MSc in Data Science | AI Enthusiast  
ğŸ’¼ Applying for Vibe Coder @ HUMAIN  
""")
